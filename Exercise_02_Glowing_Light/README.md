# Exercise 02: Control Blue LED on GPIO2 (Glowing Light Effect)

The aim of this exercise is to control the blue LED on GPIO2, dradually changing the LED brightness to create the glowing effect on the Hibiscus Sense board.

In this exercise, we will use the same blue LED in [Exercise 1](https://github.com/myinvent/hibiscus-sense-arduino#exercise-1-control-blue-led-on-gpio2-strobe-light-effect), but producing glowing light effect, as the image shown below. Where the blue LED color will start from OFF and slowly glowing until it reach its maximum brightness and turn OFF again, repeatedly.

<p align="center"><a href="https://myduino.com/product/myd-036/"><img src="https://github.com/myinvent/hibiscus-sense/raw/main/references/image-exercise-two.gif" width="300"></a></p>

As we know, the output signal from [Exercise 1](https://github.com/myinvent/hibiscus-sense-arduino#exercise-1-control-blue-led-on-gpio2-strobe-light-effect) is `DIGITAL OUTPUT`, where the output signal is either turn ON or turn OFF, but to achieve glowing light effect, we need an output signal that has ranges of values from minimum to maximum value.

What we need is the Pulse-Width Modulation (PWM), where the signal output that has been generated by the PWM, is almost **`ANALOG OUTPUT`**, but not a true sine wave analog output. PWM is a modulation technique which generates variable-width pulses in the duty cycle of digital signal (square wave), where in average over time, it is representing analog output signal, as shown in the image below.

<p align="center"><a href="https://myduino.com/product/myd-036/"><img src="https://github.com/myinvent/hibiscus-sense/raw/main/references/image-exercise-two-a.gif" width="500"></a></p>

With PWM output signal, we can control brightness of LEDs, the speed of motors, the heat of the heating elements, the vibration of piezo elements for buzzer loudness, the direction of the servo motors and modulated audio signal.

ESP32 have 16 congifurable independent PWM channels, which can be configured to generate PWM signal on all GPIOs, except GPIO34 to GPIO39.

The `analogWrite(_gpio_, _dutycycle_)` function will be used to generate PWM signal output, the function has 2 arguments:
- _gpio_ the GPIO number for output of the PWM signal.
- _dutycycle_ the PWM duty cycle value. For 8 bits resolutions, the value range from 0 - 255.

Again, to be remember, the blue LED circuit on Hibiscus Sense is active-low, so we will program the LED for glowing effect as follows:

## Complete Sketch
```cpp
void setup() {
  // declare the GPIO number for PWM signal output.
  pinMode(2, OUTPUT);
}

void loop() {
  // statement for() to create decremental value by -1
  // for active-low LED circuit, the PWM value begin from 255 --> 0
  // from OFF LED to linear increasing brightnes.
  for(int brightness = 255; brightness >= 150; brightness--){   
    // function will generate PWM output signal according to variable brightness value
    analogWrite(2, brightness);
    delay(30);
  }
  // wait for 0.2 seconds before repeating the process.
  delay(200);
}
```

You can copy the sketch above, paste it into the Arduino IDE and upload the complete sketch to ESP32, then observe the output. By observatoin, the output of the blue LED is repeatedly glowing light effect, which the results from decremental value of the PWM signal output.

## Detail Sketch Explanations

As usual, in the `void setup()` function, we will configure GPIO2 as an `OUTPUT`.
```cpp
pinMode(2, OUTPUT);
```

Inside the `void loop()` function, we will control the brightness of the blue LED to produce glowing blue LED effect. Since the blue LED circuit is active-low, the PWM value begins from _(255 to 0)_. In order to produce, glowing effect, we need have a decremental PWM value 1 by 1, from 255 to 254, from 254 to 253, from 253 to 252 and so on until the value reach minimum PWM value, for example, 150. We can use `for()` statement to automatically generate decremental variable of PWM value from 255-150 as follows, where the `analogWrite()` function is inside `for()` statement:
```cpp
for(int brightness = 255; brightness >= 150; brightness--){   
    // function will generate PWM output signal according to variable brightness value
    analogWrite(2, brightness);
    delay(30);
  }
```

<p align="center"><a href="https://myduino.com/product/myd-036/"><img src="https://github.com/myinvent/hibiscus-sense/raw/main/references/image-exercise-two-b.gif" width="600"></a></p>

## Further Experiment
You can adjust the rate of brightness change to customize the effect.

<p align="right"><a href="https://forms.gle/UgpDSFc46K4MkvTM8">&#128640; Tutorial Improvement & Suggestions</a></p>